# Hướng dẫn cài đặt và sử dụng mô hình Vosk tiếng Việt 0.4

Để nhận dạng giọng nói tiếng Việt offline, ứng dụng sử dụng mô hình Vosk 0.4. 
Bạn cần tải mô hình tiếng Việt và đặt các file vào thư mục đúng.

## Tải và cài đặt mô hình tiếng Việt

1. Tải mô hình tiếng Việt từ trang chủ Vosk: https://alphacephei.com/vosk/models
2. Tìm và tải mô hình "vosk-model-vn-0.4" (~31MB) - đây là phiên bản mô hình tiếng Việt mới nhất
3. Giải nén file và đặt tất cả nội dung vào thư mục:
   - Cách 1: `app/src/main/assets/model-vi` (được đồng bộ tự động khi chạy)
   - Cách 2: Giải nén thủ công vào `{internal_storage}/vosk-model-vn-0.4` trên thiết bị

## Cấu trúc thư mục và file

Cấu trúc thư mục mô hình sau khi cài đặt:

```
vosk-model-vn-0.4/
├── am/
├── conf/
├── ivector/
├── graph/
├── phones/
├── README
├── final.mdl
├── ... các file khác
```

## Cấu hình dự án

1. Trong file `settings.gradle.kts`, đảm bảo đã thêm repository cho Vosk:
```kotlin
repositories {
    // ...
    maven { url = uri("https://alphacephei.com/maven/") }
}
```

2. Trong file `app/build.gradle.kts`, đảm bảo đã thêm các dependency:
```kotlin
dependencies {
    // ...
    implementation("com.alphacephei:vosk-android:0.3.47")
    implementation("net.java.dev.jna:jna:5.13.0@aar")
}
```

## Xử lý lỗi thường gặp với mô hình 0.4

1. **Lỗi "No such file or directory"**: Kiểm tra đường dẫn đến mô hình và đảm bảo mô hình được đặt đúng vị trí.

2. **Lỗi "Failed to initialize model"**: Phiên bản 0.4 yêu cầu cấu trúc thư mục chính xác. Đảm bảo các file và thư mục con (am, conf, ivector...) được giữ nguyên khi giải nén.

3. **Lỗi quyền "RECORD_AUDIO"**: Đảm bảo ứng dụng đã yêu cầu và được cấp quyền ghi âm trước khi sử dụng.

4. **Lỗi bộ nhớ**: Mô hình 0.4 nhẹ hơn (~31MB) so với phiên bản trước (~40MB), nhưng vẫn cần đủ bộ nhớ để chạy.

## Sử dụng mô hình 0.4 với ImprovedVoiceRecognitionHelper

Class `ImprovedVoiceRecognitionHelper` đã được cập nhật để hỗ trợ mô hình vosk-model-vn-0.4:

```kotlin
val voiceHelper = ImprovedVoiceRecognitionHelper(
    context = context,
    onRecognitionResult = { text -> 
        // Xử lý kết quả nhận dạng ở đây
    },
    onStatusChange = { status ->
        // Cập nhật UI dựa trên trạng thái
    }
)

// Bắt đầu ghi âm và nhận dạng
voiceHelper.startListening()

// Dừng ghi âm và lấy kết quả
voiceHelper.stopListening()

// Giải phóng tài nguyên khi không cần nữa
voiceHelper.destroy()
```

## Ưu điểm của mô hình tiếng Việt 0.4

1. **Kích thước nhỏ hơn**: ~31MB so với ~40MB của phiên bản 0.3
2. **Nhận dạng chính xác hơn**: Đặc biệt với những từ và cụm từ thông dụng trong tiếng Việt
3. **Tốc độ xử lý nhanh hơn**: Tối ưu hơn cho thiết bị di động
4. **Hỗ trợ nhiều phương ngữ**: Cải thiện khả năng nhận dạng với các phương ngữ miền Bắc, miền Trung và miền Nam

Để biết thêm thông tin, vui lòng truy cập: https://github.com/alphacep/vosk-api 